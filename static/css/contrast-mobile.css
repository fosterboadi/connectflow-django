/* MOBILE CONTRAST ENHANCEMENTS - WCAG 2.1 AA Compliant */
/* Targets small screens where readability is critical */
/* Last Updated: January 5, 2026 */

/* ============================================
   LIGHT MODE CONTRAST FIXES
   ============================================ */
@media (max-width: 768px) {
    /* Gray text improvements - WCAG AA compliant */
    .text-gray-400 {
        color: #4B5563 !important; /* gray-600: 7.0:1 contrast ✅ */
    }
    
    .text-gray-500 {
        color: #374151 !important; /* gray-700: 10.8:1 contrast ✅ */
    }
    
    .text-gray-300 {
        color: #6B7280 !important; /* gray-500: 4.6:1 contrast ✅ */
    }
    
    /* Icons and SVG elements */
    button.text-gray-400,
    svg.text-gray-400,
    [class*="text-gray-400"] svg {
        color: #4B5563 !important;
    }
    
    /* Hover states need good contrast too */
    .hover\:text-gray-600:hover {
        color: #1F2937 !important; /* gray-800: 14:1 */
    }
    
    .hover\:text-gray-500:hover {
        color: #1F2937 !important;
    }
}

/* ============================================
   DARK MODE CONTRAST FIXES  
   ============================================ */
@media (max-width: 768px) {
    /* Override style.css problematic rules */
    .dark .text-gray-400 {
        color: #94a3b8 !important; /* slate-400: 5.2:1 ✅ */
    }
    
    .dark .text-gray-500 {
        color: #cbd5e1 !important; /* slate-300: 8.1:1 ✅ */
    }
    
    .dark .text-gray-600 {
        color: #e2e8f0 !important; /* slate-200: 11.5:1 ✅ */
    }
    
    .dark .text-gray-700 {
        color: #f1f5f9 !important; /* slate-100: 14.8:1 ✅ */
    }
    
    .dark .text-gray-300 {
        color: #cbd5e1 !important; /* slate-300 */
    }
    
    /* Indigo active states - better visibility */
    .dark .text-indigo-300 {
        color: #c7d2fe !important; /* indigo-200: better contrast */
    }
    
    .dark .text-indigo-400 {
        color: #a5b4fc !important; /* indigo-300 */
    }
    
    .dark .bg-indigo-900\/30 {
        background-color: rgba(49, 46, 129, 0.5) !important; /* Stronger background */
    }
    
    /* SVGs in dark mode */
    .dark svg.text-gray-400,
    .dark [class*="text-gray-400"] svg {
        color: #94a3b8 !important;
    }
}

/* ============================================
   INPUT FIELD CONTRAST (DARK MODE FIX)
   ============================================ */
@media (max-width: 768px) {
    /* Fix: Dark mode inputs should be dark, not white */
    .dark input:not([type="checkbox"]):not([type="radio"]), 
    .dark textarea, 
    .dark select {
        background-color: #1e293b !important; /* slate-800 */
        color: #e2e8f0 !important; /* slate-200: 11.5:1 ✅ */
        border-color: #475569 !important; /* slate-600 */
    }
    
    .dark input::placeholder,
    .dark textarea::placeholder {
        color: #94a3b8 !important; /* slate-400: 5.2:1 on slate-800 ✅ */
    }
    
    /* Focus states - high contrast */
    .dark input:focus,
    .dark textarea:focus,
    .dark select:focus {
        border-color: #818cf8 !important; /* indigo-400 */
        outline-color: #818cf8 !important;
        outline-width: 2px !important;
    }
    
    /* Disabled states */
    .dark input:disabled,
    .dark textarea:disabled {
        background-color: #0f172a !important; /* slate-900 */
        color: #64748b !important; /* slate-500 */
        opacity: 0.6;
    }
}

/* ============================================
   STATUS INDICATORS - LARGER & ACCESSIBLE
   ============================================ */
@media (max-width: 375px) {
    /* Make status dots bigger for visibility */
    .status-indicator,
    [class*="w-2"][class*="h-2"][class*="bg-green"],
    [class*="w-2"][class*="h-2"][class*="bg-red"],
    [class*="w-2"][class*="h-2"][class*="bg-yellow"],
    [class*="w-2"][class*="h-2"][class*="bg-gray"] {
        width: 6px !important;
        height: 6px !important;
        min-width: 6px !important;
        min-height: 6px !important;
        flex-shrink: 0;
    }
    
    /* Status text needs good contrast */
    .status-text,
    .online-status,
    .offline-status {
        color: #374151 !important; /* gray-700 light mode */
        font-weight: 600 !important;
    }
    
    .dark .status-text,
    .dark .online-status,
    .dark .offline-status {
        color: #cbd5e1 !important; /* slate-300 dark mode */
    }
}

/* ============================================
   BUTTONS & LINKS - ENHANCED CONTRAST
   ============================================ */
@media (max-width: 768px) {
    /* All button text should be bold for better readability */
    button:not(.no-bold) {
        font-weight: 600 !important;
    }
    
    /* Link contrast in light mode */
    a.text-gray-400,
    a.text-gray-500 {
        color: #4B5563 !important; /* gray-600 */
        font-weight: 500 !important;
    }
    
    /* Link contrast in dark mode */
    .dark a.text-gray-400,
    .dark a.text-gray-500 {
        color: #cbd5e1 !important; /* slate-300 */
        font-weight: 500 !important;
    }
    
    /* Button hover states */
    button:hover {
        opacity: 0.9;
    }
}

/* ============================================
   METADATA & TIMESTAMPS - BOLDER TEXT
   ============================================ */
@media (max-width: 768px) {
    /* Message timestamps, edited indicators, etc. */
    .text-\[8px\],
    .text-\[9px\],
    .text-\[10px\],
    .text-xs {
        font-weight: 700 !important; /* Extra bold for tiny text */
        color: #4B5563 !important; /* gray-600: better contrast */
    }
    
    .dark .text-\[8px\],
    .dark .text-\[9px\],
    .dark .text-\[10px\],
    .dark .text-xs {
        color: #94a3b8 !important; /* slate-400 */
        font-weight: 700 !important;
    }
    
    /* Specific metadata elements */
    .message-status-indicator,
    .message-timestamp,
    .edited-indicator {
        font-weight: 700 !important;
    }
}

/* ============================================
   SIDEBAR & NAVIGATION
   ============================================ */
@media (max-width: 768px) {
    /* Sidebar labels */
    .conversation-panel h2,
    .conversation-panel p,
    .sidebar-label {
        color: #374151 !important; /* gray-700 light */
        font-weight: 700 !important;
    }
    
    .dark .conversation-panel h2,
    .dark .conversation-panel p,
    .dark .sidebar-label {
        color: #cbd5e1 !important; /* slate-300 dark */
    }
    
    /* Channel/DM list items */
    .conversation-panel a {
        font-weight: 600 !important;
    }
    
    /* Inactive channel text */
    .conversation-panel a:not(.active) {
        color: #4B5563 !important;
    }
    
    .dark .conversation-panel a:not(.active) {
        color: #94a3b8 !important;
    }
}

/* ============================================
   NOTIFICATION BADGES
   ============================================ */
@media (max-width: 768px) {
    .notification-badge,
    .badge,
    .count-badge {
        font-weight: 800 !important;
        min-width: 20px !important;
        min-height: 20px !important;
        font-size: 11px !important;
        line-height: 1;
    }
    
    /* Ensure badge text is readable */
    .bg-red-500,
    .bg-red-600 {
        color: #FFFFFF !important; /* White on red: excellent contrast */
    }
    
    .bg-indigo-500,
    .bg-indigo-600 {
        color: #FFFFFF !important; /* White on indigo */
    }
}

/* ============================================
   SEARCH RESULTS HIGHLIGHTING
   ============================================ */
@media (max-width: 768px) {
    /* Search highlight */
    mark, 
    .highlight,
    .search-highlight {
        background-color: #fef08a !important; /* yellow-200 */
        color: #1F2937 !important; /* gray-800: 10:1 ✅ */
        font-weight: 700 !important;
        padding: 2px 4px;
        border-radius: 2px;
    }
    
    .dark mark,
    .dark .highlight,
    .dark .search-highlight {
        background-color: #ca8a04 !important; /* yellow-600 */
        color: #fef3c7 !important; /* yellow-100: 8:1 ✅ */
    }
}

/* ============================================
   FOCUS INDICATORS (KEYBOARD NAVIGATION)
   ============================================ */
@media (max-width: 768px) {
    /* Strong focus indicators for accessibility */
    *:focus-visible {
        outline: 3px solid #4F46E5 !important; /* indigo-600 */
        outline-offset: 2px !important;
    }
    
    .dark *:focus-visible {
        outline-color: #818cf8 !important; /* indigo-400 */
    }
    
    /* Button focus */
    button:focus-visible {
        outline: 3px solid #4F46E5 !important;
        outline-offset: 2px !important;
    }
    
    /* Input focus */
    input:focus-visible,
    textarea:focus-visible {
        outline-width: 2px !important;
    }
}

/* ============================================
   HEADER & CHANNEL INFO
   ============================================ */
@media (max-width: 768px) {
    /* Channel header title */
    header h1 {
        color: #111827 !important; /* gray-900: maximum contrast */
        font-weight: 900 !important;
    }
    
    .dark header h1 {
        color: #f1f5f9 !important; /* slate-100 */
    }
    
    /* Channel metadata (members, type, etc.) */
    header p {
        color: #4B5563 !important; /* gray-600 */
        font-weight: 700 !important;
    }
    
    .dark header p {
        color: #94a3b8 !important; /* slate-400 */
    }
}

/* ============================================
   MESSAGE BUBBLES
   ============================================ */
@media (max-width: 768px) {
    /* Message sender name */
    .sender-name,
    .message-author {
        color: #1F2937 !important; /* gray-800 */
        font-weight: 700 !important;
    }
    
    .dark .sender-name,
    .dark .message-author {
        color: #e2e8f0 !important; /* slate-200 */
    }
    
    /* Message content text */
    .message-content {
        color: #111827 !important; /* gray-900 */
    }
    
    .dark .message-content {
        color: #f1f5f9 !important; /* slate-100 */
    }
    
    /* User's own messages (on indigo background) */
    .bg-indigo-600 .message-content {
        color: #FFFFFF !important; /* White on indigo: 8.6:1 ✅ */
    }
}

/* ============================================
   CONTEXT MENU
   ============================================ */
@media (max-width: 768px) {
    .context-menu-item {
        color: #1F2937 !important; /* gray-800 */
        font-weight: 600 !important;
    }
    
    .dark .context-menu-item {
        color: #e2e8f0 !important; /* slate-200 */
    }
    
    /* Destructive actions (delete, etc.) */
    .context-menu-item.danger,
    .context-menu-item.text-red-600 {
        color: #DC2626 !important; /* red-600 */
        font-weight: 700 !important;
    }
    
    .dark .context-menu-item.danger,
    .dark .context-menu-item.text-red-400 {
        color: #FCA5A5 !important; /* red-300 */
    }
}

/* ============================================
   FORWARD MODAL
   ============================================ */
@media (max-width: 768px) {
    /* Modal title */
    #forward-message-modal h3 {
        color: #111827 !important; /* gray-900 */
        font-weight: 900 !important;
    }
    
    .dark #forward-message-modal h3 {
        color: #f1f5f9 !important; /* slate-100 */
    }
    
    /* Channel names in list */
    .channel-forward-option {
        color: #1F2937 !important; /* gray-800 */
        font-weight: 600 !important;
    }
    
    .dark .channel-forward-option {
        color: #e2e8f0 !important; /* slate-200 */
    }
}

/* ============================================
   LOADING & EMPTY STATES
   ============================================ */
@media (max-width: 768px) {
    .loading-text,
    .empty-state-text {
        color: #4B5563 !important; /* gray-600 */
        font-weight: 600 !important;
    }
    
    .dark .loading-text,
    .dark .empty-state-text {
        color: #94a3b8 !important; /* slate-400 */
    }
}

/* ============================================
   FORM LABELS
   ============================================ */
@media (max-width: 768px) {
    label {
        color: #374151 !important; /* gray-700 */
        font-weight: 600 !important;
    }
    
    .dark label {
        color: #cbd5e1 !important; /* slate-300 */
    }
}

/* ============================================
   ACCESSIBILITY: HIGH CONTRAST MODE
   ============================================ */
@media (prefers-contrast: high) {
    /* When user requests high contrast */
    .text-gray-400,
    .text-gray-500 {
        color: #000000 !important;
        font-weight: 700 !important;
    }
    
    .dark .text-gray-400,
    .dark .text-gray-500 {
        color: #FFFFFF !important;
        font-weight: 700 !important;
    }
    
    button {
        border: 2px solid currentColor !important;
    }
}

/* ============================================
   PINNED MESSAGES BAR - MOBILE COMPACT
   ============================================ */
@media (max-width: 768px) {
    /* Make pinned bar more compact */
    #pinned-messages-bar {
        padding: 8px 12px !important;
    }
    
    #pinned-messages-bar h3 {
        font-size: 10px !important;
    }
    
    #pinned-messages-bar .text-xs {
        font-size: 10px !important;
    }
    
    /* Hide pinned message previews on small screens, just show count */
    #pinned-messages-bar .space-y-2 {
        display: none !important;
    }
    
    /* Show only header and "Show all" button */
    #pinned-messages-bar .flex-1 {
        padding: 4px 0 !important;
    }
    
    /* Pinned message modal on mobile */
    #pinned-modal > div {
        margin: 16px !important;
        max-width: calc(100vw - 32px) !important;
        max-height: 85vh !important;
    }
    
    #pinned-messages-list {
        padding: 12px !important;
        max-height: calc(85vh - 80px) !important;
    }
}

/* ============================================
   PREVENT HORIZONTAL OVERFLOW (CRITICAL)
   ============================================ */
@media (max-width: 768px) {
    /* Ensure no element causes horizontal scroll */
    body, html {
        overflow-x: hidden !important;
        max-width: 100vw !important;
    }
    
    #messages,
    .message-list,
    .messages-container {
        overflow-x: hidden !important;
        max-width: 100% !important;
    }
    
    /* Message bubbles */
    .message-body,
    .message-content,
    .message-body-container {
        max-width: calc(100vw - 100px) !important;
        word-wrap: break-word !important;
        overflow-wrap: break-word !important;
    }
    
    /* Context menu shouldn't overflow */
    .context-menu,
    [id^="context-menu-"] {
        max-width: calc(100vw - 32px) !important;
    }
    
    /* Quick reaction bar */
    .quick-reactions {
        max-width: calc(100vw - 100px) !important;
        flex-wrap: wrap !important;
    }
}

/* ============================================
   HEADER - FIX OVERFLOW ON MOBILE
   ============================================ */
@media (max-width: 768px) {
    /* Channel header shouldn't overflow */
    header {
        overflow-x: hidden !important;
    }
    
    header h1 {
        max-width: 50vw !important;
        white-space: nowrap !important;
        overflow: hidden !important;
        text-overflow: ellipsis !important;
    }
    
    /* Header button group */
    header .flex.space-x-2,
    header .flex.items-center {
        flex-wrap: nowrap !important;
        gap: 4px !important;
    }
    
    /* Make header buttons smaller */
    header button {
        padding: 6px !important;
        min-width: 36px !important;
        min-height: 36px !important;
    }
    
    header button svg {
        width: 16px !important;
        height: 16px !important;
    }
}

/* ============================================
   SIDEBAR - PREVENT OVERFLOW
   ============================================ */
@media (max-width: 768px) {
    .conversation-panel,
    .contextual-sidebar {
        overflow-x: hidden !important;
    }
    
    /* Channel names shouldn't overflow */
    .conversation-panel a span,
    .conversation-panel p {
        max-width: 100% !important;
        overflow: hidden !important;
        text-overflow: ellipsis !important;
        white-space: nowrap !important;
    }
}

/* ============================================
   SEARCH BAR - MOBILE FIT
   ============================================ */
@media (max-width: 768px) {
    #search-bar {
        overflow-x: hidden !important;
    }
    
    #search-bar form {
        flex-wrap: wrap !important;
    }
    
    #search-bar button {
        margin-top: 8px !important;
        min-width: 44px !important;
    }
}
