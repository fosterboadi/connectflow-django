/* EMERGENCY MOBILE FIX - Complete PWA Overhaul */
/* iPhone 5S to iPhone 14 Pro Max Support */
/* Created: January 5, 2026 */

/* ============================================
   NUCLEAR OPTION: FIX EVERYTHING
   ============================================ */

/* Step 1: Reset all problematic spacing */
@media (max-width: 768px) {
    /* Kill all excessive padding/margin */
    * {
        max-width: 100vw !important;
    }
    
    body, html {
        overflow-x: hidden !important;
        width: 100% !important;
        position: relative !important;
    }
    
    /* Main container */
    #app,
    main,
    .main-content {
        padding: 0 !important;
        margin: 0 !important;
        width: 100% !important;
    }
}

/* ============================================
   HEADER FIX - Stop overflow
   ============================================ */
@media (max-width: 768px) {
    header {
        padding: 12px 8px !important;
        height: auto !important;
        min-height: 56px !important;
        overflow: hidden !important;
    }
    
    header h1 {
        font-size: 16px !important;
        max-width: 45vw !important;
        overflow: hidden !important;
        text-overflow: ellipsis !important;
        white-space: nowrap !important;
    }
    
    /* Header buttons */
    header button,
    header a {
        padding: 8px !important;
        min-width: 40px !important;
        min-height: 40px !important;
    }
    
    header svg {
        width: 18px !important;
        height: 18px !important;
    }
    
    /* Button group spacing */
    header .flex {
        gap: 4px !important;
    }
}

/* ============================================
   SIDEBAR FIX - Make collapsible
   ============================================ */
@media (max-width: 768px) {
    /* Sidebar should be off-screen by default */
    .conversation-panel,
    aside {
        position: fixed !important;
        left: -100% !important;
        top: 0 !important;
        height: 100vh !important;
        width: 80vw !important;
        max-width: 300px !important;
        z-index: 50 !important;
        transition: left 0.3s ease !important;
        overflow-y: auto !important;
        overflow-x: hidden !important;
    }
    
    /* When sidebar is open */
    .conversation-panel.open,
    aside.open {
        left: 0 !important;
    }
    
    /* Sidebar backdrop */
    .sidebar-backdrop {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.5);
        z-index: 49;
    }
    
    .sidebar-backdrop.active {
        display: block !important;
    }
}

/* ============================================
   MESSAGES AREA FIX
   ============================================ */
@media (max-width: 768px) {
    #messages,
    .messages-container {
        padding: 8px !important;
        width: 100% !important;
        overflow-x: hidden !important;
    }
    
    /* Individual message bubbles */
    .message-item {
        margin-bottom: 8px !important;
        max-width: 100% !important;
    }
    
    /* Message content */
    .message-body {
        max-width: 85vw !important;
        padding: 8px 12px !important;
    }
    
    .message-content {
        font-size: 15px !important;
        line-height: 1.4 !important;
        word-wrap: break-word !important;
        overflow-wrap: break-word !important;
    }
    
    /* Avatar */
    .message-avatar,
    .avatar {
        width: 36px !important;
        height: 36px !important;
        flex-shrink: 0 !important;
    }
    
    /* Sender name */
    .sender-name,
    .message-author {
        font-size: 14px !important;
        font-weight: 700 !important;
    }
    
    /* Timestamp */
    .message-timestamp,
    .timestamp {
        font-size: 11px !important;
        font-weight: 700 !important;
    }
}

/* ============================================
   INPUT AREA FIX
   ============================================ */
@media (max-width: 768px) {
    #message-form,
    .message-input-container {
        padding: 8px !important;
        gap: 8px !important;
    }
    
    #message-input,
    textarea[name="message"] {
        font-size: 16px !important; /* Prevent iOS zoom */
        padding: 12px !important;
        min-height: 44px !important;
        max-height: 120px !important;
    }
    
    /* Send button */
    button[type="submit"] {
        min-width: 44px !important;
        min-height: 44px !important;
        padding: 10px !important;
    }
    
    /* Attachment buttons */
    .attachment-btn {
        min-width: 40px !important;
        min-height: 40px !important;
    }
}

/* ============================================
   HIDE PROBLEMATIC ELEMENTS ON MOBILE
   ============================================ */
@media (max-width: 768px) {
    /* Hide pinned messages bar */
    #pinned-messages-bar {
        display: none !important;
    }
    
    /* Hide quick reaction bar (use context menu instead) */
    .quick-reactions {
        display: none !important;
    }
    
    /* Hide hover tooltips */
    [title]:hover::after,
    .tooltip {
        display: none !important;
    }
    
    /* Simplify context menu */
    .context-menu {
        max-width: calc(100vw - 32px) !important;
        font-size: 14px !important;
    }
    
    .context-menu button {
        padding: 12px 16px !important;
        min-height: 44px !important;
    }
}

/* ============================================
   MODALS FIX
   ============================================ */
@media (max-width: 768px) {
    /* All modals */
    [id*="modal"] > div,
    .modal-content {
        width: calc(100vw - 32px) !important;
        max-width: calc(100vw - 32px) !important;
        margin: 16px !important;
        max-height: 90vh !important;
    }
    
    /* Modal header */
    .modal-header,
    [id*="modal"] h2,
    [id*="modal"] h3 {
        font-size: 18px !important;
        padding: 16px !important;
    }
    
    /* Modal body */
    .modal-body,
    [id*="modal"] .overflow-y-auto {
        padding: 16px !important;
        font-size: 15px !important;
    }
}

/* ============================================
   SPACING RESETS - KILL BLOAT
   ============================================ */
@media (max-width: 768px) {
    /* Reduce all padding/margin classes */
    .p-6 { padding: 12px !important; }
    .p-5 { padding: 12px !important; }
    .p-4 { padding: 10px !important; }
    
    .px-6 { padding-left: 12px !important; padding-right: 12px !important; }
    .px-5 { padding-left: 12px !important; padding-right: 12px !important; }
    .px-4 { padding-left: 10px !important; padding-right: 10px !important; }
    
    .py-6 { padding-top: 12px !important; padding-bottom: 12px !important; }
    .py-5 { padding-top: 12px !important; padding-bottom: 12px !important; }
    .py-4 { padding-top: 10px !important; padding-bottom: 10px !important; }
    
    .m-6 { margin: 12px !important; }
    .m-5 { margin: 12px !important; }
    .m-4 { margin: 10px !important; }
    
    .space-y-6 > * + * { margin-top: 12px !important; }
    .space-y-5 > * + * { margin-top: 12px !important; }
    .space-y-4 > * + * { margin-top: 10px !important; }
    
    .space-x-6 > * + * { margin-left: 12px !important; }
    .space-x-5 > * + * { margin-left: 12px !important; }
    .space-x-4 > * + * { margin-left: 10px !important; }
}

/* ============================================
   TEXT SIZING - READABLE
   ============================================ */
@media (max-width: 768px) {
    /* Minimum font sizes */
    .text-xs { font-size: 12px !important; }
    .text-sm { font-size: 14px !important; }
    .text-base { font-size: 15px !important; }
    .text-lg { font-size: 17px !important; }
    .text-xl { font-size: 19px !important; }
    .text-2xl { font-size: 22px !important; }
    
    /* Tiny text becomes readable */
    [class*="text-[8px]"],
    [class*="text-[9px]"],
    [class*="text-[10px]"] {
        font-size: 12px !important;
        font-weight: 700 !important;
    }
}

/* ============================================
   FLOATING BUTTON FIXES
   ============================================ */
@media (max-width: 768px) {
    /* All floating buttons */
    [class*="fixed"] {
        z-index: 40 !important;
    }
    
    /* Pinned messages button */
    #mobile-pinned-btn {
        position: fixed !important;
        top: 70px !important;
        right: 12px !important;
        width: 48px !important;
        height: 48px !important;
        border-radius: 50% !important;
        box-shadow: 0 4px 12px rgba(0,0,0,0.25) !important;
    }
    
    /* Scroll to bottom button */
    .scroll-to-bottom {
        position: fixed !important;
        bottom: 100px !important;
        right: 12px !important;
        width: 48px !important;
        height: 48px !important;
    }
}

/* ============================================
   FORCE SINGLE COLUMN LAYOUT
   ============================================ */
@media (max-width: 768px) {
    /* Kill all multi-column layouts */
    .grid,
    .flex {
        display: block !important;
    }
    
    /* Except specific flex containers */
    header .flex,
    .message-item .flex,
    .modal-header .flex,
    #message-form .flex {
        display: flex !important;
    }
    
    /* Stack form elements */
    form .flex {
        flex-direction: column !important;
    }
    
    form button,
    form input,
    form select {
        width: 100% !important;
        margin-bottom: 8px !important;
    }
}

/* ============================================
   CRITICAL: NO HORIZONTAL SCROLL
   ============================================ */
@media (max-width: 768px) {
    /* Nuclear option */
    * {
        max-width: 100vw !important;
        box-sizing: border-box !important;
    }
    
    img, video, iframe, canvas {
        max-width: 100% !important;
        height: auto !important;
    }
    
    pre, code {
        max-width: calc(100vw - 32px) !important;
        overflow-x: auto !important;
        white-space: pre-wrap !important;
    }
    
    table {
        display: block !important;
        overflow-x: auto !important;
        max-width: 100% !important;
    }
}

/* ============================================
   SAFE AREA INSETS (iPhone notch)
   ============================================ */
@media (max-width: 768px) {
    body {
        padding-top: env(safe-area-inset-top) !important;
        padding-bottom: env(safe-area-inset-bottom) !important;
        padding-left: env(safe-area-inset-left) !important;
        padding-right: env(safe-area-inset-right) !important;
    }
    
    header {
        padding-top: max(12px, env(safe-area-inset-top)) !important;
    }
    
    #message-form {
        padding-bottom: max(8px, env(safe-area-inset-bottom)) !important;
    }
}

/* ============================================
   PERFORMANCE: Disable animations on mobile
   ============================================ */
@media (max-width: 768px) {
    * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.1s !important;
    }
}

/* ============================================
   DARK MODE MOBILE FIXES
   ============================================ */
@media (max-width: 768px) {
    .dark {
        background-color: #0f172a !important;
    }
    
    .dark header {
        background-color: #1e293b !important;
        border-bottom: 1px solid #334155 !important;
    }
    
    .dark #messages {
        background-color: #0f172a !important;
    }
    
    .dark #message-form {
        background-color: #1e293b !important;
        border-top: 1px solid #334155 !important;
    }
}
